<% layout("layouts/boilerplate") %>

<div class="container mt-4">
    <h3>Inbox</h3>
    <div class="list-group mt-3">
        <% if(conversations.length === 0) { %>
            <p>No messages yet.</p>
        <% } %>

        <% for(let conv of conversations) { %>
            <a href="/inbox/<%= conv._id._id %>" class="list-group-item list-group-item-action d-flex align-items-center">
                <img src="<%= conv._id.image && conv._id.image.url ? conv._id.image.url : 'https://via.placeholder.com/50' %>" 
                     class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;">
                
                <div class="w-100">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1"><%= conv._id.username %></h5>
                        <small class="text-muted"><%= conv.lastMessage.timestamp.toLocaleString() %></small>
                    </div>
                    <p class="mb-1 text-muted"><%= conv.lastMessage.message.substring(0, 50) %>...</p>
                    <% if(!conv.lastMessage.isRead && conv.lastMessage.receiver.equals(currUser._id)) { %>
                        <span class="badge bg-danger">New</span>
                    <% } %>
                </div>
            </a>
        <% } %>
    </div>
</div>